# Web Search è°ƒè¯•å™¨å®ç°æ€»ç»“

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¸º X-Agent å¼€å‘è€…æ¨¡å¼æ·»åŠ äº†å®Œæ•´çš„ Web Search è°ƒè¯•èƒ½åŠ›ï¼Œç”¨äºæµ‹è¯•å’ŒéªŒè¯ `web_search` å·¥å…·çš„åŠŸèƒ½ã€‚

---

## ğŸ¯ å®ç°å†…å®¹

### 1. åç«¯ API ç«¯ç‚¹

**æ–‡ä»¶**: `/backend/src/api/v1/dev.py`

#### æ–°å¢æ¥å£
```python
POST /api/v1/dev/web-search
```

#### è¯·æ±‚æ¨¡å‹
```json
{
  "query": "æœç´¢å…³é”®è¯",
  "max_results": 5
}
```

#### å“åº”æ¨¡å‹
```json
{
  "success": true,
  "query": "æœç´¢å…³é”®è¯",
  "results": [
    {
      "title": "ç»“æœæ ‡é¢˜",
      "snippet": "ç»“æœæ‘˜è¦",
      "url": "https://example.com"
    }
  ],
  "output": "æ ¼å¼åŒ–åçš„è¾“å‡ºæ–‡æœ¬",
  "error": null,
  "metadata": {
    "query": "æœç´¢å…³é”®è¯",
    "results_count": 3
  }
}
```

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… è°ƒç”¨ `WebSearchTool` æ‰§è¡Œå®é™…æœç´¢
- âœ… è§£æ DuckDuckGo API è¿”å›çš„ç»“æœ
- âœ… æä¾›ç»“æ„åŒ–æ•°æ®ï¼ˆparsed resultsï¼‰
- âœ… ä¿ç•™åŸå§‹æ ¼å¼åŒ–è¾“å‡ºï¼ˆraw outputï¼‰
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

---

### 2. å‰ç«¯ç»„ä»¶

**æ–‡ä»¶**: `/frontend/src/components/dev/WebSearchDebugger.tsx`

#### ä¸»è¦ç‰¹æ€§

1. **æœç´¢è¡¨å•**
   - æŸ¥è¯¢è¾“å…¥æ¡†
   - æœ€å¤§ç»“æœæ•°è°ƒèŠ‚ï¼ˆ1-20ï¼‰
   - å®æ—¶æœç´¢æŒ‰é’®çŠ¶æ€

2. **ç»“æœæ˜¾ç¤º**
   - ç»“æ„åŒ–åˆ—è¡¨è§†å›¾ï¼ˆé»˜è®¤ï¼‰
   - åŸå§‹è¾“å‡ºè§†å›¾ï¼ˆå¯åˆ‡æ¢ï¼‰
   - æœç´¢ç»“æœå¡ç‰‡å±•ç¤ºï¼ˆç¼–å·ã€æ ‡é¢˜ã€æ‘˜è¦ã€URLï¼‰

3. **çŠ¶æ€åé¦ˆ**
   - åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
   - é”™è¯¯æç¤ºæ¨ªå¹…
   - æˆåŠŸ/å¤±è´¥çŠ¶æ€æ ‡è¯†

4. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - ç©ºçŠ¶æ€æç¤º
   - URL åŸŸåæ ¼å¼åŒ–æ˜¾ç¤º
   - å¤–éƒ¨é“¾æ¥æ–°çª—å£æ‰“å¼€
   - å“åº”å¼è®¾è®¡

#### UI ç»„ä»¶äº®ç‚¹

```tsx
// ç»“æœå¡ç‰‡
<div className="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
  <span className="w-6 h-6 flex items-center justify-center bg-blue-100 
                   text-blue-600 rounded-full text-xs font-medium">
    {index + 1}
  </span>
  <h4 className="font-medium text-gray-900 line-clamp-2">{result.title}</h4>
  <a href={result.url} target="_blank" className="text-xs text-blue-600">
    {formatUrl(result.url)}
  </a>
  <p className="text-sm text-gray-700 line-clamp-3">{result.snippet}</p>
</div>
```

---

### 3. å¼€å‘è€…æ¨¡å¼é›†æˆ

**æ–‡ä»¶**: `/frontend/src/components/dev/DevModeWindow.tsx`

#### æ–°å¢æ ‡ç­¾é¡µ
- Tab ID: `web_search`
- æ ‡ç­¾åç§°ï¼š`Web Search`
- ä½ç½®ï¼šå¼€å‘è€…æ¨¡å¼çª—å£é¡¶éƒ¨å¯¼èˆªæ 

#### é›†æˆæ–¹å¼
```typescript
type TabType = 'logs' | 'tester' | 'trace' | 'search' 
             | 'compression_records' | 'web_search';

// Content rendering
{activeTab === 'web_search' ? (
  <WebSearchDebugger onError={setError} />
) : null}
```

---

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### æ–¹æ³• 1ï¼šé€šè¿‡å¼€å‘è€…æ¨¡å¼ç•Œé¢ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€å¼€å‘è€…æ¨¡å¼**
   - ç‚¹å‡»èŠå¤©çª—å£å³ä¸Šè§’çš„ã€Œå¼€å‘è€…æ¨¡å¼ã€æŒ‰é’®

2. **åˆ‡æ¢åˆ° Web Search æ ‡ç­¾**
   - ç‚¹å‡»é¡¶éƒ¨çš„ "Web Search" æ ‡ç­¾

3. **æ‰§è¡Œæœç´¢**
   - è¾“å…¥æœç´¢å…³é”®è¯ï¼ˆä¾‹å¦‚ï¼š"Python programming language"ï¼‰
   - è°ƒæ•´æœ€å¤§ç»“æœæ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ 5ï¼‰
   - ç‚¹å‡»ã€Œæœç´¢ã€æŒ‰é’®

4. **æŸ¥çœ‹ç»“æœ**
   - ç»“æ„åŒ–è§†å›¾ï¼šæ˜¾ç¤ºè§£æåçš„æœç´¢ç»“æœåˆ—è¡¨
   - åŸå§‹è¾“å‡ºï¼šæŸ¥çœ‹æ ¼å¼åŒ–çš„ Markdown æ–‡æœ¬
   - åˆ‡æ¢è§†å›¾ï¼šç‚¹å‡»å³ä¸Šè§’æŒ‰é’®åœ¨ä¸¤ç§è§†å›¾é—´åˆ‡æ¢

### æ–¹æ³• 2ï¼šç›´æ¥è°ƒç”¨ API

```bash
curl -X POST http://localhost:8000/api/v1/dev/web-search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Python programming language",
    "max_results": 5
  }'
```

### æ–¹æ³• 3ï¼šä»£ç ä¸­ç›´æ¥è°ƒç”¨

```python
from backend.src.tools.builtin import WebSearchTool
import asyncio

async def main():
    tool = WebSearchTool()
    result = await tool.execute(
        query="Python 3.12 new features",
        max_results=5
    )
    print(result.output)

asyncio.run(main())
```

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… 24 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… åˆå§‹åŒ–æµ‹è¯•ï¼ˆ4 ä¸ªï¼‰
- âœ… å‚æ•°éªŒè¯æµ‹è¯•ï¼ˆ5 ä¸ªï¼‰
- âœ… æ‰§è¡Œæµ‹è¯•ï¼ˆ4 ä¸ªï¼‰
- âœ… API é›†æˆæµ‹è¯•ï¼ˆ4 ä¸ªï¼‰
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆ5 ä¸ªï¼‰
- âœ… é›†æˆåœºæ™¯æµ‹è¯•ï¼ˆ2 ä¸ªï¼‰

### åŠŸèƒ½éªŒè¯
| åŠŸèƒ½ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å·¥å…·æ³¨å†Œ | âœ… | å·²é›†æˆåˆ°å†…ç½®å·¥å…·åˆ—è¡¨ |
| API ç«¯ç‚¹ | âœ… | `/api/v1/dev/web-search` æ­£å¸¸å·¥ä½œ |
| å‰ç«¯ç•Œé¢ | âœ… | å¼€å‘è€…æ¨¡å¼æ–°å¢æ ‡ç­¾é¡µ |
| ç»“æœè§£æ | âœ… | ç»“æ„åŒ–æ•°æ® + åŸå§‹è¾“å‡º |
| é”™è¯¯å¤„ç† | âœ… | ç½‘ç»œè¶…æ—¶ã€API é”™è¯¯ä¼˜é›…é™çº§ |
| æ—¥å¿—è®°å½• | âœ… | å®Œæ•´çš„æ‰§è¡Œæ—¥å¿— |

---

## ğŸ¨ ç•Œé¢é¢„è§ˆ

### æœç´¢å‰ï¼ˆç©ºçŠ¶æ€ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web Search è°ƒè¯•å™¨                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœç´¢æŸ¥è¯¢ *                           â”‚
â”‚ [è¾“å…¥æœç´¢å…³é”®è¯...]                  â”‚
â”‚                                      â”‚
â”‚ æœ€å¤§ç»“æœæ•°ï¼š[5]  [æœç´¢]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯´æ˜ï¼šä½¿ç”¨ DuckDuckGo Instant       â”‚
â”‚ Answer API è¿›è¡Œç½‘ç»œæœç´¢...           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœç´¢åï¼ˆç»“æœè§†å›¾ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœç´¢æŸ¥è¯¢ï¼š"Python programming"       â”‚
â”‚ çŠ¶æ€ï¼šæˆåŠŸ Â· ç»“æœæ•°ï¼š3               â”‚
â”‚              [æŸ¥çœ‹åŸå§‹è¾“å‡º]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘  Python (programming language)     â”‚
â”‚    en.wikipedia.org/wiki/Python     â”‚
â”‚    Python is a high-level, general- â”‚
â”‚    purpose programming language...  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘¡ Python.org - Official Docs        â”‚
â”‚    www.python.org                   â”‚
â”‚    Welcome to Python.org. Download  â”‚
â”‚    the latest version...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŸå§‹è¾“å‡ºè§†å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸå§‹æ ¼å¼åŒ–è¾“å‡º                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Search results for: Python          â”‚
â”‚                                     â”‚
â”‚ 1. **Python (programming language)**â”‚
â”‚    Python is a high-level...        â”‚
â”‚    URL: https://en.wikipedia.org... â”‚
â”‚                                     â”‚
â”‚ 2. **Python.org**                   â”‚
â”‚    Welcome to Python.org...         â”‚
â”‚    URL: https://www.python.org/     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### DuckDuckGo API é›†æˆ

**API ç«¯ç‚¹**:
```
https://api.duckduckgo.com/?q={query}&format=json&no_html=1
```

**å“åº”ç»“æ„**:
```json
{
  "Abstract": "æ‘˜è¦æ–‡æœ¬",
  "Heading": "æ ‡é¢˜",
  "AbstractURL": "https://...",
  "RelatedTopics": [
    {
      "Text": "ä¸»é¢˜æè¿°",
      "FirstURL": "https://..."
    }
  ]
}
```

**è§£æé€»è¾‘**:
1. ä¼˜å…ˆæå– `RelatedTopics`ï¼ˆç›¸å…³ä¸»é¢˜åˆ—è¡¨ï¼‰
2. å¦‚æœæ²¡æœ‰ï¼Œä½¿ç”¨ `Abstract`ï¼ˆæ‘˜è¦ä¿¡æ¯ï¼‰
3. ä»ç„¶æ²¡æœ‰åˆ™æä¾› DuckDuckGo ç½‘é¡µæœç´¢é“¾æ¥

### é”™è¯¯å¤„ç†ç­–ç•¥

```python
try:
    # è°ƒç”¨ DuckDuckGo API
    results = await _search_duckduckgo(query, max_results)
    
    if not results:
        # æ— ç»“æœæƒ…å†µ
        return ToolResult.ok("No results found...")
    
    # æ ¼å¼åŒ–ç»“æœ
    formatted = format_results(results)
    return ToolResult.ok(formatted)
    
except Exception as e:
    # API é”™è¯¯ã€ç½‘ç»œè¶…æ—¶ç­‰æƒ…å†µ
    logger.error("Web search failed", extra={"error": str(e)})
    return ToolResult.error_result(f"Web search failed: {str(e)}")
```

### å‰ç«¯çŠ¶æ€ç®¡ç†

```typescript
const [query, setQuery] = useState('');
const [maxResults, setMaxResults] = useState(5);
const [searchResponse, setSearchResponse] = useState<WebSearchResponse | null>(null);
const [isLoading, setIsLoading] = useState(false);
const [error, setError] = useState<string | null>(null);
const [showRawOutput, setShowRawOutput] = useState(false);
```

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### åŠŸèƒ½å¢å¼º
1. **æœç´¢å†å²**
   - è®°å½•æœ€è¿‘çš„æœç´¢æŸ¥è¯¢
   - æ”¯æŒå¿«é€Ÿé‡æ–°æœç´¢

2. **ç»“æœå¯¼å‡º**
   - å¯¼å‡ºä¸º JSON/Markdown
   - å¤åˆ¶å•ä¸ªç»“æœé“¾æ¥

3. **é«˜çº§æœç´¢é€‰é¡¹**
   - æ—¶é—´èŒƒå›´è¿‡æ»¤
   - ç‰¹å®šç½‘ç«™æœç´¢
   - æ–‡ä»¶ç±»å‹è¿‡æ»¤

4. **å¤šå¼•æ“æ”¯æŒ**
   - é›†æˆ Bing Search API
   - é›†æˆ Google Custom Search API
   - å¼•æ“åˆ‡æ¢å¯¹æ¯”

### æ€§èƒ½ä¼˜åŒ–
1. **ç»“æœç¼“å­˜**
   - ç›¸åŒæŸ¥è¯¢ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ
   - å‡å°‘ API è°ƒç”¨æ¬¡æ•°

2. **å¹¶å‘æœç´¢**
   - åŒæ—¶è°ƒç”¨å¤šä¸ªæœç´¢å¼•æ“
   - åˆå¹¶å»é‡æ’åº

3. **æ¸è¿›å¼åŠ è½½**
   - å…ˆæ˜¾ç¤ºå°‘é‡ç»“æœ
   - æŒ‰éœ€åŠ è½½æ›´å¤š

### ç”¨æˆ·ä½“éªŒ
1. **æ™ºèƒ½æç¤º**
   - æŸ¥è¯¢å»ºè®®è‡ªåŠ¨è¡¥å…¨
   - çƒ­é—¨æœç´¢æ¨è

2. **ç»“æœé¢„è§ˆ**
   - é¼ æ ‡æ‚¬åœæ˜¾ç¤ºç½‘é¡µå¿«ç…§
   - é«˜äº®å…³é”®è¯åŒ¹é…

3. **å¯è§†åŒ–åˆ†æ**
   - æœç´¢ç»“æœç»Ÿè®¡å›¾è¡¨
   - æ¥æºåˆ†å¸ƒé¥¼å›¾

---

## ğŸ“ ç›¸å…³æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/v1/dev.py              # æ–°å¢ web_search_debug ç«¯ç‚¹
â”‚   â””â”€â”€ tools/builtin/
â”‚       â”œâ”€â”€ web_search.py          # WebSearchTool æ ¸å¿ƒå®ç°
â”‚       â””â”€â”€ __init__.py            # å·¥å…·æ³¨å†Œ
â””â”€â”€ tests/unit/
    â””â”€â”€ test_web_search.py         # å®Œæ•´å•å…ƒæµ‹è¯•å¥—ä»¶
```

### å‰ç«¯æ–‡ä»¶
```
frontend/
â”œâ”€â”€ src/components/dev/
â”‚   â”œâ”€â”€ WebSearchDebugger.tsx      # Web Search è°ƒè¯•å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ DevModeWindow.tsx          # é›†æˆåˆ°å¼€å‘è€…æ¨¡å¼
â”‚   â””â”€â”€ index.ts                   # ç»„ä»¶å¯¼å‡º
â””â”€â”€ package.json                   # ä¾èµ–é…ç½®ï¼ˆæ— éœ€æ›´æ–°ï¼‰
```

---

## âœ… éªŒæ”¶æ ‡å‡†

- [x] åç«¯ API ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- [x] å‰ç«¯ç»„ä»¶æ¸²æŸ“æ­£ç¡®
- [x] æœç´¢ç»“æœæ­£å¸¸æ˜¾ç¤º
- [x] é”™è¯¯å¤„ç†å®Œå–„
- [x] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ 100%
- [x] å¼€å‘è€…æ¨¡å¼æ ‡ç­¾é¡µå¯è®¿é—®
- [x] è§†å›¾åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
- [x] å“åº”å¼è®¾è®¡é€‚é…

---

## ğŸ¯ æ€»ç»“

æˆåŠŸä¸º X-Agent å¼€å‘è€…æ¨¡å¼æ·»åŠ äº†å®Œæ•´çš„ Web Search è°ƒè¯•èƒ½åŠ›ï¼š

1. **å®Œæ•´æ€§**ï¼šä»åº•å±‚å·¥å…·åˆ°å‰ç«¯ç•Œé¢çš„å…¨æ ˆå®ç°
2. **å¯é æ€§**ï¼š24 ä¸ªæµ‹è¯•ç”¨ä¾‹ä¿è¯åŠŸèƒ½ç¨³å®š
3. **å¯ç”¨æ€§**ï¼šç›´è§‚çš„ UI è®¾è®¡å’Œæ¸…æ™°çš„çŠ¶æ€åé¦ˆ
4. **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºæœªæ¥æ·»åŠ æ›´å¤šæœç´¢å¼•æ“

è¿™ä¸ªè°ƒè¯•å™¨ä¸ä»…å¯ç”¨äºæµ‹è¯• `web_search` å·¥å…·ï¼Œè¿˜ä¸ºç”¨æˆ·æä¾›äº†ç›´è§‚çš„ç½‘ç»œæœç´¢èƒ½åŠ›æ¼”ç¤ºç•Œé¢ã€‚
