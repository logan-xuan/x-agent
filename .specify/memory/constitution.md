<!--
================================================================================
SYNC IMPACT REPORT
================================================================================
Version Change: 0.0.0 → 1.0.0 (Initial ratification)
Modified Principles: N/A (Initial creation)
Added Sections: 
  - I. 代码质量优先 (Code Quality First)
  - II. 测试驱动开发 (Test-Driven Development)
  - III. 关注点分离 (Separation of Concerns)
  - IV. 可调试性设计 (Debuggability by Design)
  - V. 用户体验一致性 (UX Consistency)
  - VI. 性能优先 (Performance First)
  - VII. 组合优于继承 (Composition Over Inheritance)
  - VIII. 稳定抽象原则 (Stable Abstractions Principle)
  - IX. YAGNI 原则 (You Aren't Gonna Need It)
Removed Sections: N/A
Templates Requiring Updates:
  - ✅ .specify/templates/plan-template.md (Constitution Check section aligned)
  - ✅ .specify/templates/spec-template.md (Testing requirements aligned)
  - ✅ .specify/templates/tasks-template.md (TDD workflow aligned)
Follow-up TODOs: None
================================================================================
-->

# X-Agent Constitution

## Core Principles

### I. 代码质量优先 (Code Quality First)

**非协商规则：**
- 所有代码必须通过静态代码分析工具检查，零警告容忍
- 函数复杂度不得超过 15 个决策点（圈复杂度）
- 每个公共函数必须包含类型注解/类型定义
- 代码重复率不得超过 3%（DRY 原则严格执行）
- 所有公共 API 必须包含文档字符串/注释说明

**原理：** 代码质量是项目长期可维护性的基石。个人独享 Agent 需要持续演进和自我进化，低质量代码将导致技术债务累积，阻碍系统迭代。

---

### II. 测试驱动开发 (Test-Driven Development)

**非协商规则：**
- 所有功能必须先编写测试，测试失败后方可实现代码
- 单元测试覆盖率不得低于 80%，核心模块须达 90%+
- 每个 Bug 修复必须伴随回归测试
- 集成测试必须覆盖所有跨模块交互点
- 测试必须能够在隔离环境中独立运行

**原理：** TDD 确保代码可测试性，为 Agent 的自我进化提供安全保障。测试是重构的信心来源，也是个人项目在缺乏代码审查情况下的质量保证机制。

---

### III. 关注点分离 (Separation of Concerns)

**非协商规则：**
- 每个模块只负责单一职责，职责边界必须在文档中明确定义
- 表达层、网关层、核心层、工具层、数据层严禁循环依赖
- 业务逻辑与基础设施代码必须分离
- 配置、日志、错误处理必须作为横切关注点统一管理
- 模块间通信必须通过明确定义的接口进行

**原理：** 清晰的关注点分离使系统易于理解、测试和修改。对于模块化 + 插件式架构的 Agent 系统，这是实现功能可插拔的前提条件。

---

### IV. 可调试性设计 (Debuggability by Design)

**非协商规则：**
- 所有异步操作必须包含可追踪的上下文 ID
- 日志必须采用结构化格式（JSON），包含时间戳、级别、模块、追踪 ID
- 错误信息必须包含：错误类型、发生位置、上下文数据、建议解决方案
- 必须提供运行时状态查询接口（健康检查、性能指标）
- 关键决策点必须记录决策依据（LLM 推理过程可追溯）

**原理：** Agent 执行长任务时可能出现"无响应"错觉，完善的调试能力是排查问题的关键。作为个人独享系统，用户需要能够独立诊断和解决问题。

---

### V. 用户体验一致性 (UX Consistency)

**非协商规则：**
- 所有用户交互通道（Web UI、CLI、API）必须遵循统一的响应格式
- 错误提示必须统一风格，包含错误码、用户友好消息、修复建议
- 所有配置项必须采用统一的命名规范和验证规则
- 状态反馈必须及时明确，禁止静默执行（操作后必须返回执行状态）
- 跨平台行为必须保持一致（Web、CLI、Channel 插件）

**原理：** 一致性降低用户认知负担，提升 Agent 的专业感和可信度。多通道接入（Web、钉钉、飞书、微信）要求体验统一。

---

### VI. 性能优先 (Performance First)

**非协商规则：**
- LLM 调用必须实现流式响应，首字节返回时间 < 500ms
- 上下文压缩必须在 100ms 内完成
- 向量检索必须在 200ms 内返回结果
- 内存使用必须设置上限，超出时触发优雅降级
- 所有 I/O 操作必须采用异步非阻塞模式

**原理：** 性能直接影响用户体验。作为个人智能助理，响应速度决定实用性。性能约束也防止资源滥用，确保在个人电脑上稳定运行。

---

### VII. 组合优于继承 (Composition Over Inheritance)

**非协商规则：**
- 禁止超过 2 层的类继承层次
- 功能扩展必须通过组合（插件、中间件、装饰器）实现
- 工具（Tools）和技能（Skills）必须采用统一的插件接口
- 核心组件必须通过依赖注入获取协作对象
- 行为组合必须在配置中声明，而非硬编码

**原理：** 组合提供更大的灵活性，支持运行时功能扩展。这对于支持"自我进化"和"技能扩展"的 Agent 架构至关重要。

---

### VIII. 稳定抽象原则 (Stable Abstractions Principle)

**非协商规则：**
- 抽象层（接口、抽象类）不得依赖具体实现
- 稳定模块（核心层、配置系统）必须定义清晰的接口契约
- 易变模块（工具、插件）必须依赖稳定抽象
- 接口变更必须保持向后兼容，或提供迁移路径
- 核心领域模型必须独立于框架和基础设施

**原理：** 稳定抽象保护核心业务逻辑免受技术细节变化的影响。Agent 系统需要支持多模型切换、多通道接入，稳定抽象是实现这种灵活性的基础。

---

### IX. YAGNI 原则 (You Aren't Gonna Need It)

**非协商规则：**
- 禁止实现当前迭代未使用的功能
- 禁止为未来可能的需求预留"扩展点"（除非已明确规划）
- 代码评审时必须质疑："这个功能现在真的需要吗？"
- 功能添加必须有明确的用户场景支撑
- 优先实现 P0 需求，P2 需求必须经充分论证方可进入开发

**原理：** 过度设计是项目复杂度的主要来源。个人项目资源有限，必须聚焦核心功能，避免无效投入。真正的扩展性来自于良好的设计，而非提前编写的冗余代码。

---

## Development Standards

### 代码规范

- **语言标准**：TypeScript (严格模式) + Python 3.11+
- **命名规范**：采用 camelCase (TS) / snake_case (Python)，类名 PascalCase
- **文件组织**：按功能模块分组，测试文件与被测文件同目录或 tests/ 平行目录
- **注释规范**：复杂算法必须解释"为什么"，而非"做什么"

### 安全要求

- 所有用户输入必须经过验证和清理
- 命令执行模块必须实施白名单/黑名单机制
- 敏感配置（API Key）必须加密存储
- 插件系统必须实现沙箱隔离

### 文档要求

- 每个模块必须包含 README 说明职责和接口
- 所有配置项必须包含示例和说明
- 架构决策必须记录在 docs/adr/ 目录

---

## Development Workflow

### 质量门禁

1. **提交前**：代码格式化、静态检查、单元测试通过
2. **合并前**：代码审查（自我审查）、集成测试通过、文档更新
3. **发布前**：端到端测试、性能基准测试、CHANGELOG 更新

### 版本管理

- 采用语义化版本控制 (SemVer)
- 主版本号：不兼容的架构变更
- 次版本号：功能新增（保持向后兼容）
- 修订号：Bug 修复、性能优化

---

## Governance

### 宪法权威

本宪法是 X-Agent 项目的最高技术准则，所有代码、设计决策、技术选型必须与之保持一致。当其他文档与本宪法冲突时，以本宪法为准。

### 修订程序

1. **提案**：任何修订必须以书面形式提出，说明修订理由和影响范围
2. **评估**：评估修订对现有代码的影响，制定迁移计划
3. **批准**：个人项目由项目所有者批准
4. **实施**：更新宪法版本，同步修改相关模板和文档
5. **通知**：在 CHANGELOG 中记录宪法变更

### 版本控制

- **MAJOR**：原则移除或重新定义（不兼容变更）
- **MINOR**：新增原则或实质性扩展现有原则
- **PATCH**：措辞澄清、格式调整、非语义性 refinement

### 合规审查

- 每次功能实现前必须对照宪法进行自检
- 代码审查必须包含宪法合规性检查
- 定期（每季度）审查宪法适用性，必要时提出修订

---

**Version**: 1.0.0 | **Ratified**: 2026-02-14 | **Last Amended**: 2026-02-14
