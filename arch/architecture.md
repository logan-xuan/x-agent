# 项目目标
这是一个部署于个人电脑的高权限通用AI Agent，具备代码编写、自然语言对话、浏览器自动化（Playwright）、CLI操作、文件系统访问、定时任务与技能扩展能力，通过首次交互定义身份并存储记忆，支持自我进化，实现高度自主的私人智能助理。

# 优先级定义
p0  优先级最高 mvp版本需要完成p0需求
p1  其次
p2  最低

# 技术架构
## 技术栈
技术语言：TypeScript(前端) + python(后端)
要求采用模块化 + 插件式架构，便于扩展功能



## 架构分层
核心链路：Expression（表达）->Gateway（网关接入）->Agent Core（智能体核心）-> tools（工具库和执行）->DBM（databese数据库存储和管理）
基础能力：配置文件管理、上下文工程、记忆系统、心跳机制、插件模块、命令执行模块、Cron 定时任务管理

### Expression 表达层

#### 用户界面 (p0)

● Web UI (React + TS)  webchat  WebSocket / REST API  可以进行文字、图片、文件的方式进行沟通
● 实时日志流 
● 设置入口：大模型切换设置，skill，plugin、mcp、channel配置
#### Channel 消息渠道扩展（p3）

可以接入飞书、钉钉、微信消息渠道，能力与webchat一致用于与agent继续沟通的渠道。
以插件形式接入

### Gateway 网关接入层（p1）

承上启下，接收上层消息传递至Agent。
session 管理、消息队列流控、权限控制、日志统一、分类收集。
http或WebSocket通信链路管理。
心跳检测：主要检查agent与表达层的链接状态，确保agent在执行长任务活跃状态检测
### Agent Core 控制中心(p0)
该系统通过意图识别、上下文压缩与模块化解耦，实现由LLM驱动的透明、自循环且可追溯的AI Agent执行流程。
LLM 推理引擎
Context engineering  (上下文压缩、记忆系统)
Task Planner（任务规划）
Skill Router（技能路由)


### Tools 工具执行层（p1）

1、系统级的tools和plugin，模块化可插拔，后续可迭代。
  - Web Search 
  - Code Interpreter 
  - File System Access 
  - Command Executor 
  - Office Automation
  - Cron 定时任务管理
  - Browser Control 通过自然语言沟通对chrome浏览器自动化操作，可以购物，搜索网页，填写表单，截图，分析数据（基于Playwright）

2、客户自定义技能存放在项目根目录 workspace


### DBM 数据存储与管理 （p1）
● Vector DB: sqlite-vss 
● SQLite: 历史记录  
● Cache & Logs
● MarkDown 文件存储用户日志记忆

## 特别技术设计
### 配置文件 (p0)
配置管理体系是一个结构清晰、灵活可扩展的 AI Agent 中枢系统，支持多模型统一配置（抽象厂商细节）、即插即用切换，提供插件化、多通信通道（钉钉/飞书/CLI）、网关控制（端口/限流），采用模块化 yaml 设计，实现高内聚、易维护的一套配置。
如模型配置:provider/baseUrl/apiKey/modelId，不依赖厂商，可以进行一主多备自动切换 不需要配置环境变量，直接在x-agent.yaml 统一管理，默认支持阿里bailia。n
详见: ./config.md

### 上下文工程(p0)
不是把所有历史塞给 LLM，而是只传递最精准、最关键的上下文
X-Agent 对话管理系统旨在实现高效的对话管理与上下文压缩，通过多轮压缩抽取关键事实并卸载至长期记忆，解决上下文长度限制和性能问题。系统在达到预设阈值（如140轮）时自动触发分段归档，并保留最近N轮对话加上前段生成的摘要，从而生成包含身份、用户画像和混合检索记忆的综合提示。
详见：./conversation.md

同时增加每个会话session的交互记录，同步到sqlite，便于后续查询
详见：./session.md

### 记忆系统(p0)
这是一套高度结构化、具备“自我认知”与“记忆演化能力”的 AI 助手系统，采用双写架构（Markdown 文件保障人类可读性 + sqlite-vss 实现 AI 可检索的本地向量存储），构建多层记忆体系（含每日日志、长期记忆与引导文件），通过 SOUL.md 与 USER.md,tools.md 在首次启动时完成身份初始化，实现个性化自我认知；系统在启动时按优先级自动加载上下文，并利用 watchdog 实时监听文件变更以保持数据同步，结合基于 (0.7 × 向量相似度) + (0.3 × 文本匹配得分) 的混合评分机制，实现精准、语义增强的检索体验，全面支持记忆的持续生长、动态更新与高效调用。
详见：./memory.md

### 心跳机制(p1)
为应对 AI Agent 执行长任务时的“无响应”错觉，设计一套轻量、可靠的心跳机制，通过周期性发送存活信号，实现对 RAG 检索、代码执行、多步规划等耗时操作的实时状态监控；

详见：./heartbeat.md

### 插件模块(p3)
旨在构建一个可插拔、热加载、安全隔离的扩展系统，通过标准化通信接口与模块化设计，实现插件放入 plugins/ 目录后自动识别、动态启停而无需重启服务；支持按需配置权限、隔离运行依赖，并提供前端可视化管理，使开发者能像安装 App 一样为 AI Agent 安全、灵活地扩展新能力。
详见：./plugin.md

### 命令执行模块(p1)
允许大模型（LLM）在本地安全、可控的权限范围内执行常见 CLI 命令（如 ls, cp, mkdir, grep, chmod，find 等）及用户自定义的 kill 操作。所有命令默认都可以执行，通过黑名单机制不可执行、可选择沙箱模式和审计日志进行管控，行为可追溯、系统不被破坏，实现智能化与安全性的平衡。
详见：./command.md

### Agent执行引擎(p0)
该系统通过意图识别、上下文压缩与模块化解耦，实现由LLM驱动的透明、自循环且可追溯的AI Agent执行流程。
详见：./agentCore.md


### Cron 定时任务管理(p1)
Cron 定时任务管理系统通过解析自然语言或标准 cron 表达式，实现自动化创建、调度与执行一次性或周期性任务；具备任务列表管理、状态监控、历史记录等核心功能，依托高可靠执行引擎支持时间触发、队列管理、并发控制及错误重试，并深度集成 AI Agent 能力，确保提醒与任务在指定时间准确、稳定执行。

详见：./corn.md


